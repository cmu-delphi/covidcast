<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>covidcast development guide • covidcast</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css"><script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet"><script src="pkgdown.js"></script><meta property="og:title" content="covidcast development guide"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-title-body">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">covidcast</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="articles/covidcast.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="articles/plotting-signals.html">1. Plotting and mapping signals</a>
    </li>
    <li>
      <a href="articles/correlation-utils.html">2. Computing signal correlations</a>
    </li>
    <li>
      <a href="articles/multi-signals.html">3. Manipulating multiple signals</a>
    </li>
    <li>
      <a href="articles/external-data.html">4. Combine external data sources and COVIDcast data</a>
    </li>
  </ul></li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/cmu-delphi/covidcast/tree/main/R-packages/covidcast" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
    <div class="page-header">
      <h1>covidcast development guide</h1>
    </div>

<div id="covidcast-development-guide" class="section level1">
<p>We use <code>main</code> as the primary development branch. Because <code>main</code> is deployed to GitHub Pages, we update the rendered documentation only when releasing a new version to CRAN.</p>
<p>A short checklist for submitting pull requests:</p>
<ol style="list-style-type: decimal"><li>Run the unit tests with <code><a href="https://devtools.r-lib.org/reference/test.html" class="external-link">devtools::test()</a></code> and ensure they pass.</li>
<li>If you have added any new features (new functions, new options, etc.), add a brief description to <code>NEWS.md</code> to the next listed version number. Also ensure that new functions or datasets are listed in the reference in <code>_pkgdown.yml</code> so they appear in a good place in the documentation website.</li>
<li>Some of the vignettes take too long to re-build on CRAN, so they have been precompiled. They are stored with a file name “.Rmd.orig” and converted into an “.Rmd” that has no running R code. These should be rebuilt to test changes when updating the package, which can be done with the script precompile.R found in the vignette directory.</li>
<li>If you changed any documentation, rebuild the documentation with <code><a href="https://devtools.r-lib.org/reference/document.html" class="external-link">devtools::document()</a></code>. You might locally run <code><a href="https://pkgdown.r-lib.org/reference/build_site.html" class="external-link">pkgdown::build_site()</a></code> to ensure the site builds correctly, but <strong>do not commit the <code>docs/</code> changes unless you are ready to make a new CRAN release</strong>, because they will appear on the documentation website as soon as they are merged. (Building the site can be slow, because our vignettes take a long time to build.)</li>
<li>Submit the pull request and see if the CI can also successfully run the tests.</li>
</ol><div class="section level2">
<h2 id="unit-tests">Unit tests<a class="anchor" aria-label="anchor" href="#unit-tests"></a></h2>
<p>Unit tests are provided in <code>tests/testthat/</code> and use the <a href="https://testthat.r-lib.org/" class="external-link">testthat package</a>. Tests are automatically run as part of <code>R CMD check</code>, but during package development, the easiest way to run all tests is via <code><a href="https://devtools.r-lib.org/reference/test.html" class="external-link">devtools::test()</a></code> from within the package working directory.</p>
<p>Our continuous integration (CI) on GitHub will automatically run the unit tests when you open a pull request, as part of running <code>R CMD check</code>. Failed tests and check errors will both result in the build failing and errors being visible in the pull request.</p>
<div class="section level3">
<h3 id="testing-plots">Testing plots<a class="anchor" aria-label="anchor" href="#testing-plots"></a></h3>
<p>We test our plots and maps with the <a href="https://github.com/r-lib/vdiffr" class="external-link">vdiffr</a> package, which renders plots and then visually compares them to a saved reference image (saved in <code>tests/testthat/_snaps/</code>).</p>
<p>See <code>tests/testthat/test-plot.R</code> for examples. Each test case uses <code><a href="https://vdiffr.r-lib.org/reference/expect_doppelganger.html" class="external-link">vdiffr::expect_doppelganger</a></code> with two arguments: a name (which will be the filename of the saved plot, so ensure this is descriptive and unique) and a plot, such as a ggplot object.</p>
<p>When you add new test case or change how a plotting feature works, you will need to “validate” the tests, meaning vdiffr will render the plots and ask you if they look correct. To do this, run <code><a href="https://testthat.r-lib.org/reference/snapshot_accept.html" class="external-link">testthat::snapshot_review()</a></code> from within the package working directory. A Shiny app will open up and present you with each plot. For new plots, it will simply show you the plot, and a “Validate” button will let you indicate that the plot looks good. For changed plots, it will show you the difference between the saved image and the new plot. You must ensure that the changes look correct, then press Validate.</p>
<p>Once you’ve validated all changes, press Quit and you will be able to commit the changed images and run the tests successfully.</p>
<p>Note that the tests only run on R 4.1.0 or newer, since changes in the R graphics engine can cause spurious differences between rendered versions of the plots.</p>
</div>
<div class="section level3">
<h3 id="testing-api-interactions">Testing API interactions<a class="anchor" aria-label="anchor" href="#testing-api-interactions"></a></h3>
<p>To write unit tests for interactions with the API server, we need a way to use static files as mock API server responses. We use <code><a href="https://enpiar.com/r/httptest/reference/with_mock_api.html" class="external-link">httptest::with_mock_api()</a></code> for this purpose. See the comments in <code>tests/testthat/test-covidcast.R</code> for details and examples.</p>
</div>
<div class="section level3">
<h3 id="using-data-files-in-tests">Using data files in tests<a class="anchor" aria-label="anchor" href="#using-data-files-in-tests"></a></h3>
<p>Unit tests should not depend on being able to load data from the COVIDcast API, since that data is subject to change. For tests such as plots that need some data to use, it is preferable to either use toy examples or to store static datasets to be loaded and used.</p>
<p>Small static datasets can be kept in <code>tests/testthat/data/</code> in RDS form (using <code>saveRDS</code> and <code>loadRDS</code>). The <code><a href="https://testthat.r-lib.org/reference/test_path.html" class="external-link">testthat::test_path</a></code> function locates files relative to the <code>tests/testthat/</code> directory regardless of your current working directory, so for example you can use</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">foo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu">test_path</span><span class="op">(</span><span class="st">"data/foo.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>to load <code>tests/testthat/data/foo.rds</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a></h2>
<p>We use <a href="https://cran.r-project.org/web/packages/roxygen2/vignettes/roxygen2.html" class="external-link">roxygen2</a> and <a href="https://pkgdown.r-lib.org/index.html" class="external-link">pkgdown</a> to build good-looking documentation automatically. We should strive to have clear documentation for all exported functions and data, as well as vignettes giving examples of all major package features.</p>
<p>After changing a vignette or documentation, you’ll need to rebuild the documentation. Use <code><a href="https://devtools.r-lib.org/reference/document.html" class="external-link">devtools::document()</a></code> to do this. Then <code>pkgdown::build_site(".")</code> (from within the package directory) will rebuild the HTML documentation site, if you’re ready to release the changes to the world.</p>
</div>
<div class="section level2">
<h2 id="release-checklist">Release checklist<a class="anchor" aria-label="anchor" href="#release-checklist"></a></h2>
<p>To release a new public version of the package, copy the template below into a new GitHub Issue and check off the items one at a time.</p>
<pre><code>- [ ] Increment the version number in `DESCRIPTION`
- [ ] Update `NEWS.md` to describe all new features, bug fixes, and breaking changes since the last version
- [ ] Run `devtools::check()` and ensure there are no errors.
- [ ] Run `devtools::document()` and then `pkgdown::build_site()`.
- [ ] Browse the generated documentation site and ensure there are no problems.
- [ ] Commit the updated HTML. Make sure you don't miss any new plot files!
- [ ] Open a pull request to merge the release branch to `main` and request review.</code></pre>
<p>The package can now be built and submitted to CRAN, and once accepted, the pull request can be merged to main.</p>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>

</div>



      <footer><div class="copyright">
  <p></p><p>Developed by Taylor Arnold, Jacob Bien, Logan Brooks, Sarah Colquhoun, David Farrow, Alex Reinhart, Ryan Tibshirani.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

