<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>evalcast development guide • evalcast</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script>




<meta property="og:title" content="evalcast development guide" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-title-body">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">evalcast</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="articles/evalcast.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/cmu-delphi/covidcast/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="contents col-md-9">
    <div class="page-header">
      <h1>evalcast development guide</h1>
    </div>

<div id="evalcast-development-guide" class="section level1">

<p><code>evalcast</code> is currently in beta. We use a git flow model for development; new features are developed on the <code>evalcast</code> branch so they can be beta-tested before release.</p>
<p>To make a change to the package, pull the latest version of <code>evalcast</code> and make a branch starting from there. When you open a pull request, set the base branch to be <code>evalcast</code>, <em>not</em> <code>main</code>.</p>
<p>A short checklist for submitting pull requests:</p>
<ol>
<li>Run the unit tests with <code><a href="https://devtools.r-lib.org//reference/test.html">devtools::test()</a></code> and ensure they pass.</li>
<li>If you changed any documentation, rebuild the documentation with <code><a href="https://devtools.r-lib.org//reference/document.html">devtools::document()</a></code> and then <code><a href="https://pkgdown.r-lib.org/reference/build_site.html">pkgdown::build_site()</a></code>. (This can be slow, because our vignettes take a long time to build.)</li>
<li>Submit the pull request, setting the base branch to <code>evalcast</code>, and see if the CI can also successfully run the tests.</li>
</ol>
<div id="unit-tests" class="section level2">
<h2 class="hasAnchor">
<a href="#unit-tests" class="anchor"></a>Unit tests</h2>
<p>Unit tests are provided in <code>tests/testthat/</code> and use the <a href="https://testthat.r-lib.org/">testthat package</a>. Tests are automatically run as part of <code>R CMD check</code>, but during package development, the easiest way to run all tests is via <code><a href="https://devtools.r-lib.org//reference/test.html">devtools::test()</a></code> from within the package working directory.</p>
<p>Our continuous integration (CI) on GitHub will automatically run the unit tests when you open a pull request, as part of running <code>R CMD check</code>. Failed tests and check errors will both result in the build failing and errors being visible in the pull request.</p>
<div id="testing-plots" class="section level3">
<h3 class="hasAnchor">
<a href="#testing-plots" class="anchor"></a>Testing plots</h3>
<p>We test our plots and maps with the <a href="https://github.com/r-lib/vdiffr">vdiffr</a> package, which renders plots and then visually compares them to a saved reference image.</p>
<p>See <code>tests/testthat/test-plot_coverage.R</code> for examples. Each test case uses <code><a href="https://rdrr.io/pkg/vdiffr/man/expect_doppelganger.html">vdiffr::expect_doppelganger</a></code> with two arguments: a name (which will be the filename of the saved plot, so ensure this is descriptive and unique) and a plot, such as a ggplot object.</p>
<p>When you add new test case or change how a plotting feature works, you will need to “validate” the tests, meaning vdiffr will render the plots and ask you if they look correct. To do this, run <code>vdiffr::manage_cases()</code> from within the package working directory. A Shiny app will open up and present you with each plot. For new plots, it will simply show you the plot, and a “Validate” button will let you indicate that the plot looks good. For changed plots, it will show you the difference between the saved image and the new plot. You must ensure that the changes look correct, then press Validate.</p>
<p>Once you’ve validated all changes, press Quit and you will be able to commit the changed images and run the tests successfully.</p>
</div>
<div id="using-data-files-in-tests" class="section level3">
<h3 class="hasAnchor">
<a href="#using-data-files-in-tests" class="anchor"></a>Using data files in tests</h3>
<p>Unit tests should not depend on being able to load data from the COVIDcast API, since that data is subject to change. It is preferable to either use toy examples or to store static datasets to be loaded and used.</p>
<p>Small static datasets can be kept in <code>tests/testthat/data/</code> in RDS form (using <code>saveRDS</code> and <code>loadRDS</code>). The <code><a href="https://testthat.r-lib.org/reference/test_path.html">testthat::test_path</a></code> function locates files relative to the <code>tests/testthat/</code> directory regardless of your current working directory, so for example you can use</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">foo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu">test_path</span><span class="op">(</span><span class="st">"data/foo.rds"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>to load <code>tests/testthat/data/foo.rds</code>.</p>
</div>
</div>
<div id="documentation" class="section level2">
<h2 class="hasAnchor">
<a href="#documentation" class="anchor"></a>Documentation</h2>
<p>We use <a href="https://cran.r-project.org/web/packages/roxygen2/vignettes/roxygen2.html">roxygen2</a> and <a href="https://pkgdown.r-lib.org/index.html">pkgdown</a> to build good-looking documentation automatically. We should strive to have clear documentation for all exported functions and data, as well as vignettes giving examples of all major package features.</p>
<p>After changing a vignette or documentation, you’ll need to rebuild the documentation. Use <code><a href="https://devtools.r-lib.org//reference/document.html">devtools::document()</a></code> to do this. Then <code><a href="https://pkgdown.r-lib.org/reference/build_site.html">pkgdown::build_site(".")</a></code> (from within the package directory) will rebuild the HTML documentation site.</p>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>

</div>



      <footer>
      <div class="copyright">
  <p>Developed by Daniel McDonald, Jacob Bien, Mike O'Brien, Jed Grabman, Sarah Colquhoun, Balasubramanian Narasimhan, Ryan Tibshirani.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


