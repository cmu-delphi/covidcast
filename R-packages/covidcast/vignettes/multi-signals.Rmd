---
title: Manipulating multiple signals 
output: rmarkdown::html_vignette
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, message = FALSE}
library(covidcast)

start_day <- "2020-06-01"
end_day <- "2020-10-01"

signals <- suppressMessages(
  covidcast_signals(data_source = "usa-facts",
                    signal = c("confirmed_incidence_num", 
                               "deaths_incidence_num"),
                    start_day = start_day, end_day = end_day,
                    geo_type = "state")
)

summary(signals[[1]])
summary(signals[[2]])
```

## Applying shifts 

```{r}
library(dplyr)

apply_shifts(signals[[1]], dt = c(-1, 0, 1)) %>% 
  filter(geo_value == "tx") %>% select(contains("value")) %>% head()

apply_shifts(signals[[2]], dt = c(-1, 0, 1)) %>% 
  filter(geo_value == "tx") %>% select(contains("value")) %>% head()

a = apply_shifts(signals, dt = c(-1, 0, 1)) 
a[[1]] %>% filter(geo_value == "tx") %>% select(contains("value")) %>% head()
a[[2]] %>% filter(geo_value == "tx") %>% select(contains("value")) %>% head()

b = apply_shifts(signals, dt = list(c(-1, 0, 1), 1))
b[[1]] %>% filter(geo_value == "tx") %>% select(contains("value")) %>% head()
b[[2]] %>% filter(geo_value == "tx") %>% select(contains("value")) %>% head()
```

## Aggregating signals, wide format

```{r}
aggregate_signals(signals, format = "wide") %>% head()
aggregate_signals(signals, dt = c(0, 7), format = "wide") %>% head()
aggregate_signals(signals, dt = list(0, c(0, 7)), format = "wide") %>% head()
```

## Aggregating signals, long format

```{r}
aggregate_signals(signals, format = "long") %>% 
  filter(geo_value == "tx", time_value <= "2020-06-03") 

aggregate_signals(signals, dt = c(0, 7), format = "long") %>% 
  filter(geo_value == "tx", time_value <= "2020-06-02") 

aggregate_signals(signals, dt = list(0, 7), format = "long") %>% 
  filter(geo_value == "tx", time_value <= "2020-06-02") 
```

## Pivoting longer or wider

Longer

```{r}
aggregate_signals(signals, format = "wide") %>% 
  covidcast_longer() %>% 
  filter(geo_value == "tx", time_value <= "2020-06-03") 

aggregate_signals(signals, dt = list(0, 7), format = "wide") %>% 
  covidcast_longer() %>% 
  filter(geo_value == "tx", time_value <= "2020-06-02") 
```

Wider 

```{r}
aggregate_signals(signals, format = "long") %>% 
  covidcast_wider() %>% head()

aggregate_signals(signals, dt = list(0, 7), format = "long") %>% 
  covidcast_wider() %>% head()
```