<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Estimate derivatives of values in covidcast_signal data frame — estimate_deriv • modeltools</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Estimate derivatives of values in covidcast_signal data frame — estimate_deriv" />
<meta property="og:description" content="Estimates derivatives of the values in a covidcast_signal data frame, using
a local (in time) linear regression or smoothing spline. (When multiple issue
dates are present, only the latest issue is considered.)  See the
estimating derivatives vignette
for examples." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">modeltools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/modeltools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/pct-change.html">1. Compute percentage change over time</a>
    </li>
    <li>
      <a href="../articles/estimate-deriv.html">2. Estimate derivatives of signals</a>
    </li>
    <li>
      <a href="../articles/quantgen-forecast.html">3. Produce and evaluate quantile forecasts</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/cmu-delphi/covidcast/tree/main/R-packages/modeltools">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Estimate derivatives of values in <code>covidcast_signal</code> data frame</h1>
    <small class="dont-index">Source: <a href='https://github.com/cmu-delphi/covidcast/blob/main/R-packages/modeltools/R/deriv.R'><code>R/deriv.R</code></a></small>
    <div class="hidden name"><code>estimate_deriv.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Estimates derivatives of the values in a <code>covidcast_signal</code> data frame, using
a local (in time) linear regression or smoothing spline. (When multiple issue
dates are present, only the latest issue is considered.)  See the
<a href='https://cmu-delphi.github.io/covidcast/modeltoolsR/articles/estimate-deriv.html'>estimating derivatives vignette</a>
for examples.</p>
    </div>

    <pre class="usage"><span class='fu'>estimate_deriv</span><span class='op'>(</span>
  <span class='va'>x</span>,
  method <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"lin"</span>, <span class='st'>"ss"</span>, <span class='st'>"tf"</span><span class='op'>)</span>,
  n <span class='op'>=</span> <span class='fl'>14</span>,
  col_name <span class='op'>=</span> <span class='st'>"deriv"</span>,
  keep_obj <span class='op'>=</span> <span class='cn'>FALSE</span>,
  deriv <span class='op'>=</span> <span class='fl'>1</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>The <code>covidcast_signal</code> data frame under consideration.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>One of "lin", "ss", or "tf" indicating the method to use for
the derivative calculation. To estimate the derivative at any time point,
we run the given method on the last <code>n</code> days of data, and use the
corresponding predicted derivative (that is, the derivative of the
underlying estimated function, linear or spline) at the current time
point. Default is "lin". See details below.</p></td>
    </tr>
    <tr>
      <th>n</th>
      <td><p>Size of the local window (in days) to use. For example, if <code>n = 5</code>,
then to estimate the derivative on November 5, we train the given method on
data in between November 1 and November 5. Default is 14.</p></td>
    </tr>
    <tr>
      <th>col_name</th>
      <td><p>String indicating the name of the new column that will
contain the derivative values. Default is "deriv"; note that setting
<code>col_name = "value"</code> will overwrite the existing "value" column.</p></td>
    </tr>
    <tr>
      <th>keep_obj</th>
      <td><p>Should the fitted object (from linear regression, smoothing
spline, or trend filtering) be kept as a separate column? If <code>TRUE</code>, then
this column name is given by  appending "_obj" to <code>col_name</code>. Default is
<code>FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>deriv</th>
      <td><p>Order of derivative to estimate. Only orders 1 or 2 are allowed,
with the default being 1. (In some cases, a second-order derivative will
return a trivial result: for example: when <code>method = "lin"</code>, this will
always be zero.)</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments to pass to the function that estimates
derivatives. See details below.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A data frame given by appending a new column to <code>x</code> named according
to the <code>col_name</code> argument, containing the estimated derivative values.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Derivatives are estimated using:</p>
<ul>
<li><p>Linear regression, when <code>method = "lin"</code>, via <code><a href='https://rdrr.io/r/stats/lsfit.html'>stats::lsfit()</a></code>.</p></li>
<li><p>Cubic smoothing spline, when <code>method = "ss"</code>, via
<code><a href='https://rdrr.io/r/stats/smooth.spline.html'>stats::smooth.spline()</a></code>.</p></li>
<li><p>Polynomial trend filtering, when <code>method = "tf"</code>, via
<code><a href='https://rdrr.io/pkg/genlasso/man/trendfilter.html'>genlasso::trendfilter()</a></code>.</p></li>
</ul>

<p>The second and third cases base the derivative calculation on a nonparametric
fit and should typically be used with a larger window <code>n</code>. The third case
(trend filtering) is more locally adaptive than the second (smoothing
spline) and can work better when there are sharp changes in the smoothness
of the underlying values.</p>
<p>In the first and second cases (linear regression and smoothing spline), the
additional arguments in <code>...</code> are directly passed to the underlying
estimation function (<code><a href='https://rdrr.io/r/stats/lsfit.html'>stats::lsfit()</a></code> and <code><a href='https://rdrr.io/r/stats/smooth.spline.html'>stats::smooth.spline()</a></code>).</p>
<p>The third case (trend filtering) works a little differently. Here, a custom
set of arguments is allowed (and are internally distributed as appropriate
to <code><a href='https://rdrr.io/pkg/genlasso/man/trendfilter.html'>genlasso::trendfilter()</a></code>, <code><a href='https://rdrr.io/pkg/genlasso/man/cv.trendfilter.html'>genlasso::cv.trendfilter()</a></code>, and
<code><a href='https://rdrr.io/pkg/genlasso/man/coef.genlasso.html'>genlasso::coef.genlasso()</a></code>):</p>
<dl>
<dt><code>ord</code></dt><dd><p>Order of piecewise polynomial for the trend filtering fit,
default is 2.</p></dd>
<dt><code>maxsteps</code></dt><dd><p>Maximum number of steps to take in the solution path before
terminating, default is 100.</p></dd>
<dt><code>cv</code></dt><dd><p>Boolean indicating whether cross-validation should be used to
choose an effective degrees of freedom for the fit, default is <code>FALSE</code>.</p></dd>
<dt><code>k</code></dt><dd><p>Number of folds if cross-validation is to be used. Default is 5.</p></dd>
<dt><code>df</code></dt><dd><p>Desired effective degrees of freedom for the trend filtering
fit. If <code>cv = FALSE</code>, then <code>df</code> must be an integer; if <code>cv = TRUE</code>, then
<code>df</code> should be one of "min" or "1se" indicating the selection rule to use
based on the cross-validation error curve (minimum or 1-standard-error
rule, respectively). Default is 8 when <code>cv = FALSE</code>, and "1se" when <code>cv = TRUE</code>.</p></dd>

</dl>


  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Ryan Tibshirani.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


