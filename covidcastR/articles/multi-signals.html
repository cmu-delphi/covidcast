<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3. Manipulating multiple signals • covidcast</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="3. Manipulating multiple signals">
<meta property="og:description" content="Download multiple signals at once, and aggregate and manipulate them in various ways.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">covidcast</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/covidcast.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/plotting-signals.html">1. Plotting and mapping signals</a>
    </li>
    <li>
      <a href="../articles/correlation-utils.html">2. Computing signal correlations</a>
    </li>
    <li>
      <a href="../articles/multi-signals.html">3. Manipulating multiple signals</a>
    </li>
    <li>
      <a href="../articles/external-data.html">4. Combine external data sources and COVIDcast data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/cmu-delphi/covidcast/tree/main/R-packages/covidcast" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>3. Manipulating multiple signals</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/cmu-delphi/covidcast/blob/main/R-packages/covidcast/vignettes/multi-signals.Rmd" class="external-link"><code>vignettes/multi-signals.Rmd</code></a></small>
      <div class="hidden name"><code>multi-signals.Rmd</code></div>

    </div>

    
    
<p>Various analyses involve working with multiple signals at once. The
covidcast package provides some helper functions for fetching multiple
signals from the API, and aggregating them into one data frame for
various downstream uses.</p>
<div class="section level2">
<h2 id="fetching-multiple-signals">Fetching multiple signals<a class="anchor" aria-label="anchor" href="#fetching-multiple-signals"></a>
</h2>
<p>To load confirmed cases and deaths at the state level, in a single
function call, we can use <code><a href="../reference/covidcast_signals.html">covidcast_signals()</a></code> (note the
plural form of “signals”):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cmu-delphi.github.io/covidcast/covidcastR/" class="external-link">covidcast</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">start_day</span> <span class="op">&lt;-</span> <span class="st">"2020-06-01"</span></span>
<span><span class="va">end_day</span> <span class="op">&lt;-</span> <span class="st">"2020-10-01"</span></span>
<span></span>
<span><span class="va">signals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/covidcast_signals.html">covidcast_signals</a></span><span class="op">(</span>data_source <span class="op">=</span> <span class="st">"jhu-csse"</span>,</span>
<span>                             signal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"confirmed_7dav_incidence_prop"</span>,</span>
<span>                                        <span class="st">"deaths_7dav_incidence_prop"</span><span class="op">)</span>,</span>
<span>                             start_day <span class="op">=</span> <span class="va">start_day</span>, end_day <span class="op">=</span> <span class="va">end_day</span>,</span>
<span>                             geo_type <span class="op">=</span> <span class="st">"state"</span>, geo_values <span class="op">=</span> <span class="st">"tx"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">signals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>A `covidcast_signal` dataframe with 123 rows and 15 columns.

data_source : jhu-csse
signal      : confirmed_7dav_incidence_prop
geo_type    : state

first date                          : 2020-06-01
last date                           : 2020-10-01
median number of geo_values per day : 1</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">signals</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>A `covidcast_signal` dataframe with 123 rows and 15 columns.

data_source : jhu-csse
signal      : deaths_7dav_incidence_prop
geo_type    : state

first date                          : 2020-06-01
last date                           : 2020-10-01
median number of geo_values per day : 1</code></pre>
<p>This returns a list of <code>covidcast_signal</code> objects. The
argument structure for <code><a href="../reference/covidcast_signals.html">covidcast_signals()</a></code> matches that of
<code><a href="../reference/covidcast_signal.html">covidcast_signal()</a></code>, except the first four arguments
(<code>data_source</code>, <code>signal</code>, <code>start_day</code>,
<code>end_day</code>) are allowed to be vectors. See the
<code><a href="../reference/covidcast_signals.html">covidcast_signals()</a></code> documentation for details.</p>
</div>
<div class="section level2">
<h2 id="aggregating-signals-wide-format">Aggregating signals, wide format<a class="anchor" aria-label="anchor" href="#aggregating-signals-wide-format"></a>
</h2>
<p>To aggregate multiple signals together, we can use the
<code><a href="../reference/aggregate_signals.html">aggregate_signals()</a></code> function, which accepts a list of
<code>covidcast_signal</code> objects, as returned by
<code><a href="../reference/covidcast_signals.html">covidcast_signals()</a></code>. With all arguments set to their
default values, <code><a href="../reference/aggregate_signals.html">aggregate_signals()</a></code> returns a data frame in
“wide” format:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/aggregate_signals.html">aggregate_signals</a></span><span class="op">(</span><span class="va">signals</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>  geo_value time_value value+0:jhu-csse_confirmed_7dav_incidence_prop
1        tx 2020-06-01                                       3.393256
2        tx 2020-06-02                                       3.644320
3        tx 2020-06-03                                       3.723629
4        tx 2020-06-04                                       6.985028
5        tx 2020-06-05                                       7.920192
6        tx 2020-06-06                                       8.034533
  value+0:jhu-csse_deaths_7dav_incidence_prop
1                                   0.0856342
2                                   0.0953654
3                                   0.0909864
4                                   0.0977982
5                                   0.1002310
6                                   0.0909864</code></pre>
<p>In “wide” format, only the latest issue of data is retained, and the
columns <code>data_source</code>, <code>signal</code>,
<code>issue</code>, <code>lag</code>, <code>stderr</code>,
<code>sample_size</code> are all dropped from the returned data frame.
Each unique signal—defined by a combination of data source name, signal
name, and time-shift—is given its own column, whose name indicates its
defining quantities.</p>
<p>As hinted above, <code><a href="../reference/aggregate_signals.html">aggregate_signals()</a></code> can also apply
time-shifts to the given signals, through the optional <code>dt</code>
argument. This can be either be a single vector of shifts or a list of
vectors of shifts, this list having the same length as the list of
<code>covidcast_signal</code> objects (to apply, respectively, the same
shifts or a different set of shifts to each
<code>covidcast_signal</code> object). Negative shifts translate into in
a <em>lag</em> value and positive shifts into a <em>lead</em> value; for
example, if <code>dt = -1</code>, then the value on June 2 that gets
reported is the original value on June 1; if <code>dt = 0</code>, then
the values are left as is.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/aggregate_signals.html">aggregate_signals</a></span><span class="op">(</span><span class="va">signals</span>, dt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>  geo_value time_value value-1:jhu-csse_confirmed_7dav_incidence_prop
1        tx 2020-06-01                                             NA
2        tx 2020-06-02                                       3.393256
3        tx 2020-06-03                                       3.644320
4        tx 2020-06-04                                       3.723629
5        tx 2020-06-05                                       6.985028
6        tx 2020-06-06                                       7.920192
  value+0:jhu-csse_confirmed_7dav_incidence_prop
1                                       3.393256
2                                       3.644320
3                                       3.723629
4                                       6.985028
5                                       7.920192
6                                       8.034533
  value-1:jhu-csse_deaths_7dav_incidence_prop
1                                          NA
2                                   0.0856342
3                                   0.0953654
4                                   0.0909864
5                                   0.0977982
6                                   0.1002310
  value+0:jhu-csse_deaths_7dav_incidence_prop
1                                   0.0856342
2                                   0.0953654
3                                   0.0909864
4                                   0.0977982
5                                   0.1002310
6                                   0.0909864</code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/aggregate_signals.html">aggregate_signals</a></span><span class="op">(</span><span class="va">signals</span>, dt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>  geo_value time_value value+0:jhu-csse_confirmed_7dav_incidence_prop
1        tx 2020-06-01                                       3.393256
2        tx 2020-06-02                                       3.644320
3        tx 2020-06-03                                       3.723629
4        tx 2020-06-04                                       6.985028
5        tx 2020-06-05                                       7.920192
6        tx 2020-06-06                                       8.034533
  value-1:jhu-csse_deaths_7dav_incidence_prop
1                                          NA
2                                   0.0856342
3                                   0.0953654
4                                   0.0909864
5                                   0.0977982
6                                   0.1002310
  value+0:jhu-csse_deaths_7dav_incidence_prop
1                                   0.0856342
2                                   0.0953654
3                                   0.0909864
4                                   0.0977982
5                                   0.1002310
6                                   0.0909864
  value+1:jhu-csse_deaths_7dav_incidence_prop
1                                   0.0953654
2                                   0.0909864
3                                   0.0977982
4                                   0.1002310
5                                   0.0909864
6                                   0.0885536</code></pre>
<p>Finally, <code><a href="../reference/aggregate_signals.html">aggregate_signals()</a></code> also accepts a single data
frame (instead of a list of data frames), intended to be convenient when
applying shifts to a single <code>covidcast_signal</code> object:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/aggregate_signals.html">aggregate_signals</a></span><span class="op">(</span><span class="va">signals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, dt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>  geo_value time_value value-1:jhu-csse_confirmed_7dav_incidence_prop
1        tx 2020-06-01                                             NA
2        tx 2020-06-02                                       3.393256
3        tx 2020-06-03                                       3.644320
4        tx 2020-06-04                                       3.723629
5        tx 2020-06-05                                       6.985028
6        tx 2020-06-06                                       7.920192
  value+0:jhu-csse_confirmed_7dav_incidence_prop
1                                       3.393256
2                                       3.644320
3                                       3.723629
4                                       6.985028
5                                       7.920192
6                                       8.034533
  value+1:jhu-csse_confirmed_7dav_incidence_prop
1                                       3.644320
2                                       3.723629
3                                       6.985028
4                                       7.920192
5                                       8.034533
6                                       7.957171</code></pre>
</div>
<div class="section level2">
<h2 id="aggregating-signals-long-format">Aggregating signals, long format<a class="anchor" aria-label="anchor" href="#aggregating-signals-long-format"></a>
</h2>
<p>We can also use <code><a href="../reference/aggregate_signals.html">aggregate_signals()</a></code> in “long” format,
with one observation per row:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/aggregate_signals.html">aggregate_signals</a></span><span class="op">(</span><span class="va">signals</span>, format <span class="op">=</span> <span class="st">"long"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>  data_source                        signal geo_value time_value   source
1    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-01 jhu-csse
2    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-02 jhu-csse
3    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-03 jhu-csse
4    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-04 jhu-csse
5    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-05 jhu-csse
6    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-06 jhu-csse
  geo_type time_type      issue  lag missing_value missing_stderr
1    state       day 2023-03-03 1005             0              5
2    state       day 2023-03-03 1004             0              5
3    state       day 2023-03-03 1003             0              5
4    state       day 2023-03-03 1002             0              5
5    state       day 2023-03-03 1001             0              5
6    state       day 2023-03-03 1000             0              5
  missing_sample_size stderr sample_size dt    value
1                   5     NA          NA  0 3.393256
2                   5     NA          NA  0 3.644320
3                   5     NA          NA  0 3.723629
4                   5     NA          NA  0 6.985028
5                   5     NA          NA  0 7.920192
6                   5     NA          NA  0 8.034533</code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/aggregate_signals.html">aggregate_signals</a></span><span class="op">(</span><span class="va">signals</span>, dt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"long"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>  data_source                        signal geo_value time_value   source
1    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-01 jhu-csse
2    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-01 jhu-csse
3    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-02 jhu-csse
4    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-02 jhu-csse
5    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-03 jhu-csse
6    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-03 jhu-csse
  geo_type time_type      issue  lag missing_value missing_stderr
1    state       day 2023-03-03 1005             0              5
2    state       day 2023-03-03 1005             0              5
3    state       day 2023-03-03 1004             0              5
4    state       day 2023-03-03 1004             0              5
5    state       day 2023-03-03 1003             0              5
6    state       day 2023-03-03 1003             0              5
  missing_sample_size stderr sample_size dt    value
1                   5     NA          NA -1       NA
2                   5     NA          NA  0 3.393256
3                   5     NA          NA -1 3.393256
4                   5     NA          NA  0 3.644320
5                   5     NA          NA -1 3.644320
6                   5     NA          NA  0 3.723629</code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/aggregate_signals.html">aggregate_signals</a></span><span class="op">(</span><span class="va">signals</span>, dt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"long"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>  data_source                        signal geo_value time_value   source
1    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-01 jhu-csse
2    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-02 jhu-csse
3    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-03 jhu-csse
4    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-04 jhu-csse
5    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-05 jhu-csse
6    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-06 jhu-csse
  geo_type time_type      issue  lag missing_value missing_stderr
1    state       day 2023-03-03 1005             0              5
2    state       day 2023-03-03 1004             0              5
3    state       day 2023-03-03 1003             0              5
4    state       day 2023-03-03 1002             0              5
5    state       day 2023-03-03 1001             0              5
6    state       day 2023-03-03 1000             0              5
  missing_sample_size stderr sample_size dt    value
1                   5     NA          NA -1       NA
2                   5     NA          NA -1 3.393256
3                   5     NA          NA -1 3.644320
4                   5     NA          NA -1 3.723629
5                   5     NA          NA -1 6.985028
6                   5     NA          NA -1 7.920192</code></pre>
<p>As we can see, time-shifts work just as before, in “wide” format.
However, in “long” format, all columns are retained, and an additional
<code>dt</code> column is added to record the time-shift being used.</p>
<p>Just as before, <code><a href="../reference/covidcast_signals.html">covidcast_signals()</a></code> can also operate on
a single data frame, to conveniently apply shifts, in “long” format:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/aggregate_signals.html">aggregate_signals</a></span><span class="op">(</span><span class="va">signals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, dt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"long"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>  data_source                        signal geo_value time_value   source
1    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-01 jhu-csse
2    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-01 jhu-csse
3    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-02 jhu-csse
4    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-02 jhu-csse
5    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-03 jhu-csse
6    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-03 jhu-csse
  geo_type time_type      issue  lag missing_value missing_stderr
1    state       day 2023-03-03 1005             0              5
2    state       day 2023-03-03 1005             0              5
3    state       day 2023-03-03 1004             0              5
4    state       day 2023-03-03 1004             0              5
5    state       day 2023-03-03 1003             0              5
6    state       day 2023-03-03 1003             0              5
  missing_sample_size stderr sample_size dt    value
1                   5     NA          NA -1       NA
2                   5     NA          NA  0 3.393256
3                   5     NA          NA -1 3.393256
4                   5     NA          NA  0 3.644320
5                   5     NA          NA -1 3.644320
6                   5     NA          NA  0 3.723629</code></pre>
</div>
<div class="section level2">
<h2 id="pivoting-longer-or-wider">Pivoting longer or wider<a class="anchor" aria-label="anchor" href="#pivoting-longer-or-wider"></a>
</h2>
<p>The package also provides functions for pivoting an aggregated signal
data frame longer or wider. These are essentially wrappers around
<code>pivot_longer()</code> and <code>pivot_wider()</code> from the
<code>tidyr</code> package, that set the column structure and column
names appropriately. For example, to pivot longer:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/aggregate_signals.html">aggregate_signals</a></span><span class="op">(</span><span class="va">signals</span>, dt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/covidcast_longer.html">covidcast_longer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>  data_source                        signal geo_value time_value dt     value
1    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-01 -1        NA
2    jhu-csse    deaths_7dav_incidence_prop        tx 2020-06-01  0 0.0856342
3    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-02 -1 3.3932560
4    jhu-csse    deaths_7dav_incidence_prop        tx 2020-06-02  0 0.0953654
5    jhu-csse confirmed_7dav_incidence_prop        tx 2020-06-03 -1 3.6443200
6    jhu-csse    deaths_7dav_incidence_prop        tx 2020-06-03  0 0.0909864</code></pre>
<p>And to pivot wider:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/aggregate_signals.html">aggregate_signals</a></span><span class="op">(</span><span class="va">signals</span>, dt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"long"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/covidcast_longer.html">covidcast_wider</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>  geo_value time_value value-1:jhu-csse_confirmed_7dav_incidence_prop
1        tx 2020-06-01                                             NA
2        tx 2020-06-02                                       3.393256
3        tx 2020-06-03                                       3.644320
4        tx 2020-06-04                                       3.723629
5        tx 2020-06-05                                       6.985028
6        tx 2020-06-06                                       7.920192
  value+0:jhu-csse_deaths_7dav_incidence_prop
1                                   0.0856342
2                                   0.0953654
3                                   0.0909864
4                                   0.0977982
5                                   0.1002310
6                                   0.0909864</code></pre>
</div>
<div class="section level2">
<h2 id="a-sanity-check">A sanity check<a class="anchor" aria-label="anchor" href="#a-sanity-check"></a>
</h2>
<p>Lastly, here’s a small sanity check, that lagging cases by 7 days
using <code><a href="../reference/aggregate_signals.html">aggregate_signals()</a></code> and correlating this with deaths
using <code><a href="../reference/covidcast_cor.html">covidcast_cor()</a></code> yields the same result as telling
<code><a href="../reference/covidcast_cor.html">covidcast_cor()</a></code> to do the time-shifting itself:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_cor1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/covidcast_cor.html">covidcast_cor</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="../reference/aggregate_signals.html">aggregate_signals</a></span><span class="op">(</span><span class="va">signals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, dt <span class="op">=</span> <span class="op">-</span><span class="fl">7</span>,</span>
<span>                                              format <span class="op">=</span> <span class="st">"long"</span><span class="op">)</span>,</span>
<span>                        y <span class="op">=</span> <span class="va">signals</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_cor2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/covidcast_cor.html">covidcast_cor</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">signals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">signals</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, dt_x <span class="op">=</span> <span class="op">-</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">df_cor1</span>, <span class="va">df_cor2</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] TRUE</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Taylor Arnold, Jacob Bien, Logan Brooks, Sarah Colquhoun, David Farrow, Kathryn Mazaitis, Alex Reinhart, Ryan Tibshirani.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
