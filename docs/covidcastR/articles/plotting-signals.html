<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Plotting and mapping signals • covidcast</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Plotting and mapping signals">
<meta property="og:description" content="covidcast">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">covidcast</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/covidcast.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/correlation-utils.html">Correlation utilities</a>
    </li>
    <li>
      <a href="../articles/plotting-signals.html">Plotting and mapping signals</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/cmu-delphi/covidcast/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="plotting-signals_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Plotting and mapping signals</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/cmu-delphi/covidcast/blob/master/vignettes/plotting-signals.Rmd"><code>vignettes/plotting-signals.Rmd</code></a></small>
      <div class="hidden name"><code>plotting-signals.Rmd</code></div>

    </div>

    
    
<p>Once you’ve fetched some COVIDcast signals using <code><a href="../reference/covidcast_signal.html">covidcast_signal()</a></code>, the returned <code>covidcast</code> objects can be plotted and mapped in various ways. The data structure is designed to be tidy and easily wrangled using your favorite packages, but the covidcast package also provides some tools for plotting and mapping signals in an easy way.</p>
<p>For this vignette, we’ll use our <a href="https://cmu-delphi.github.io/delphi-epidata/api/covidcast-signals/indicator-combination.html">combination signal</a> as an example; the combination indicator is a statistical combination of several data sources collected by Delphi, and for every county provides a measure of factors related to COVID activity. We’ll also use incident case counts. Fetching the data is simple:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">covidcast</span>)

<span class="no">df_comb</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span>(
  <span class="fu"><a href="../reference/covidcast_signal.html">covidcast_signal</a></span>(<span class="kw">data_source</span> <span class="kw">=</span> <span class="st">"indicator-combination"</span>,
                   <span class="kw">signal</span> <span class="kw">=</span> <span class="st">"nmf_day_doc_fbc_fbs_ght"</span>,
                   <span class="kw">start_day</span> <span class="kw">=</span> <span class="st">"2020-07-01"</span>, <span class="kw">end_day</span> <span class="kw">=</span> <span class="st">"2020-07-14"</span>)
)
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">df_comb</span>)</pre></body></html></div>
<pre><code>## A `covidcast_signal` data frame with 29102 rows and 10 columns.
## 
## data_source : indicator-combination
## signal      : nmf_day_doc_fbc_fbs_ght
## geo_type    : county
## 
## first date                          : 2020-07-01
## last date                           : 2020-07-14
## median number of geo_values per day : 2078</code></pre>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">df_inum</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span>(
  <span class="fu"><a href="../reference/covidcast_signal.html">covidcast_signal</a></span>(<span class="kw">data_source</span> <span class="kw">=</span> <span class="st">"jhu-csse"</span>,
                   <span class="kw">signal</span> <span class="kw">=</span> <span class="st">"confirmed_7dav_incidence_num"</span>,
                   <span class="kw">start_day</span> <span class="kw">=</span> <span class="st">"2020-07-01"</span>, <span class="kw">end_day</span> <span class="kw">=</span> <span class="st">"2020-07-14"</span>)
)
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">df_inum</span>)</pre></body></html></div>
<pre><code>## A `covidcast_signal` data frame with 44744 rows and 10 columns.
## 
## data_source : jhu-csse
## signal      : confirmed_7dav_incidence_num
## geo_type    : county
## 
## first date                          : 2020-07-01
## last date                           : 2020-07-14
## median number of geo_values per day : 3196</code></pre>
<div id="choropleth-maps" class="section level2">
<h2 class="hasAnchor">
<a href="#choropleth-maps" class="anchor"></a>Choropleth maps</h2>
<p>The default <code>plot</code> method for <code>covidcast_signal</code> objects, <code><a href="../reference/plot.covidcast_signal.html">plot.covidcast_signal()</a></code>, produces choropleth maps by using <code>ggplot2</code> and the <code>usmap</code> package:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">df_comb</span>)</pre></body></html></div>
<p><img src="plotting-signals_files/figure-html/unnamed-chunk-3-1.png" width="960"></p>
<p>The color scheme is automatically chosen to be similar to that used on the online <a href="https://covidcast.cmu.edu">COVIDcast mapping tool</a>. Also, by default, this map shows the most recent day of data available in the data frame. One can choose the day and also choose the color scales, transparency level for mega counties, and title:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">df_comb</span>, <span class="kw">time_value</span> <span class="kw">=</span> <span class="st">"2020-07-04"</span>, <span class="kw">choro_col</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">cm.colors</a></span>(<span class="fl">10</span>), <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.4</span>,
     <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Combination of COVID-19 Indicators on 2020-07-04"</span>)</pre></body></html></div>
<p><img src="plotting-signals_files/figure-html/unnamed-chunk-4-1.png" width="960"></p>
<p>By providing <code>breaks</code> and <code>colors</code>, we can create custom color scales, for example to have a log-spaced color scale for incident case counts:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">breaks</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">200</span>)
<span class="no">colors</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#D3D3D3"</span>, <span class="st">"#FFFFCC"</span>, <span class="st">"#FEDDA2"</span>, <span class="st">"#FDBB79"</span>, <span class="st">"#FD9950"</span>, <span class="st">"#EB7538"</span>,
            <span class="st">"#C74E32"</span>, <span class="st">"#A3272C"</span>, <span class="st">"#800026"</span>)

<span class="co"># Note that length(breaks) == length(colors) by design. This works as follows: </span>
<span class="co"># we assign colors[i] iff the value satisfies breaks[i] &lt;= value &lt; breaks[i+1], </span>
<span class="co"># where we take breaks[0] = -Inf and breaks[N+1] = Inf, for N = length(breaks)</span>

<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">df_inum</span>, <span class="kw">choro_col</span> <span class="kw">=</span> <span class="no">colors</span>, <span class="kw">choro_params</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">breaks</span> <span class="kw">=</span> <span class="no">breaks</span>),
     <span class="kw">title</span> <span class="kw">=</span> <span class="st">"New COVID Cases (7 Day Trailing Average) on 2020-07-14"</span>)</pre></body></html></div>
<p><img src="plotting-signals_files/figure-html/unnamed-chunk-5-1.png" width="960"></p>
<p>Lastly, we show how we can use custom breaks to (visually) answer the question: which counties have cumulative case rates of at least 1/100?</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">df_cprop</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span>(
  <span class="fu"><a href="../reference/covidcast_signal.html">covidcast_signal</a></span>(<span class="kw">data_source</span> <span class="kw">=</span> <span class="st">"jhu-csse"</span>,
                   <span class="kw">signal</span> <span class="kw">=</span> <span class="st">"confirmed_cumulative_prop"</span>,
                   <span class="kw">start_day</span> <span class="kw">=</span> <span class="st">"2020-07-01"</span>, <span class="kw">end_day</span> <span class="kw">=</span> <span class="st">"2020-07-14"</span>)
)

<span class="no">breaks</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">1000</span>)
<span class="no">colors</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#D3D3D3"</span>, <span class="st">"#FFC0CB"</span>)

<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">df_cprop</span>, <span class="kw">choro_col</span> <span class="kw">=</span> <span class="no">colors</span>, <span class="kw">choro_params</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">breaks</span> <span class="kw">=</span> <span class="no">breaks</span>, <span class="kw">legend_width</span> <span class="kw">=</span> <span class="fl">5</span>),
     <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Cumulative COVID Cases per 100k People on 2020-07-14"</span>)</pre></body></html></div>
<p><img src="plotting-signals_files/figure-html/unnamed-chunk-6-1.png" width="960"></p>
</div>
<div id="bubble-maps" class="section level2">
<h2 class="hasAnchor">
<a href="#bubble-maps" class="anchor"></a>Bubble maps</h2>
<p>As an alternative to choropleth maps, we can also quickly plot bubble maps. By default, bubble maps have 8 bubble size bins evenly spaced over the range, where zero always means zero bubble size. The legend shows all bins, interpreted as each bubble size meaning <em>at least</em> the corresponding value.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">df_inum</span>, <span class="kw">plot_type</span> <span class="kw">=</span> <span class="st">"bubble"</span>)</pre></body></html></div>
<p><img src="plotting-signals_files/figure-html/unnamed-chunk-7-1.png" width="960"></p>
<p>As before, we can of course set customized breaks. As values to the left of the first bin do not get drawn, this map is much sparser, and highlights areas with larger case counts.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">df_inum</span>, <span class="kw">plot_type</span> <span class="kw">=</span> <span class="st">"bubble"</span>, <span class="kw">bubble_params</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">20</span>, <span class="fl">200</span>, <span class="kw">len</span> <span class="kw">=</span> <span class="fl">6</span>)))</pre></body></html></div>
<p><img src="plotting-signals_files/figure-html/unnamed-chunk-8-1.png" width="960"></p>
<p>As a final example, suppose we want to plot only counties in the state of Texas. We’d like to compare counts per 100,000 against absolute counts, so we fetch the proportion signal:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">df_iprop</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span>(
  <span class="fu"><a href="../reference/covidcast_signal.html">covidcast_signal</a></span>(<span class="kw">data_source</span> <span class="kw">=</span> <span class="st">"jhu-csse"</span>,
                   <span class="kw">signal</span> <span class="kw">=</span> <span class="st">"confirmed_7dav_incidence_prop"</span>,
                   <span class="kw">start_day</span> <span class="kw">=</span> <span class="st">"2020-07-01"</span>, <span class="kw">end_day</span> <span class="kw">=</span> <span class="st">"2020-07-14"</span>)
)</pre></body></html></div>
<p>Then we make two maps side-by-side with custom ranges:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">gridExtra</span>)

<span class="no">breaks1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">100</span>, <span class="fl">1000</span>)
<span class="no">breaks2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">500</span>)

<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">df_inum</span>, <span class="kw">plot_type</span> <span class="kw">=</span> <span class="st">"bubble"</span>, <span class="kw">bubble_params</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">breaks</span> <span class="kw">=</span> <span class="no">breaks1</span>, <span class="kw">max_size</span> <span class="kw">=</span> <span class="fl">6</span>),
           <span class="kw">include</span> <span class="kw">=</span> <span class="st">"TX"</span>, <span class="kw">bubble_col</span> <span class="kw">=</span> <span class="st">"red"</span>,
           <span class="kw">title</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"Incidence Number on"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">df_inum</span>$<span class="no">time_value</span>)))
<span class="no">p2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">df_iprop</span>, <span class="kw">plot_type</span> <span class="kw">=</span> <span class="st">"bubble"</span>, <span class="kw">bubble_params</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">breaks</span> <span class="kw">=</span> <span class="no">breaks2</span>, <span class="kw">max_size</span> <span class="kw">=</span> <span class="fl">6</span>),
           <span class="kw">include</span> <span class="kw">=</span> <span class="st">"TX"</span>, <span class="kw">bubble_col</span> <span class="kw">=</span> <span class="st">"red"</span>,
           <span class="kw">title</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"Incidence Proportion on"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">df_iprop</span>$<span class="no">time_value</span>)))

<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span>(<span class="no">p1</span>, <span class="no">p2</span>, <span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<p><img src="plotting-signals_files/figure-html/unnamed-chunk-11-1.png" width="960"></p>
</div>
<div id="time-series-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#time-series-plots" class="anchor"></a>Time series plots</h2>
<p>Let’s fetch the combination indicator and case counts, but for all states rather than for all counties. This will make the time series plots more manageable.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span>({
  <span class="no">df_comb_st</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/covidcast_signal.html">covidcast_signal</a></span>(<span class="kw">data_source</span> <span class="kw">=</span> <span class="st">"indicator-combination"</span>,
                                 <span class="kw">signal</span> <span class="kw">=</span> <span class="st">"nmf_day_doc_fbc_fbs_ght"</span>,
                                 <span class="kw">start_day</span> <span class="kw">=</span> <span class="st">"2020-04-15"</span>, <span class="kw">end_day</span> <span class="kw">=</span> <span class="st">"2020-07-01"</span>,
                                 <span class="kw">geo_type</span> <span class="kw">=</span> <span class="st">"state"</span>)
  <span class="no">df_inum_st</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/covidcast_signal.html">covidcast_signal</a></span>(<span class="kw">data_source</span> <span class="kw">=</span> <span class="st">"jhu-csse"</span>,
                                 <span class="kw">signal</span> <span class="kw">=</span> <span class="st">"confirmed_7dav_incidence_num"</span>,
                                 <span class="kw">start_day</span> <span class="kw">=</span> <span class="st">"2020-04-15"</span>, <span class="kw">end_day</span> <span class="kw">=</span> <span class="st">"2020-07-01"</span>,
                                 <span class="kw">geo_type</span> <span class="kw">=</span> <span class="st">"state"</span>)
})</pre></body></html></div>
<p>By default, time series plots show all available data, including all geographies. A line for every state would be unmanageable, so let’s select a few states and plot all data for them:</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)

<span class="no">states</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"ca"</span>, <span class="st">"pa"</span>, <span class="st">"tx"</span>, <span class="st">"ny"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">df_comb_st</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">geo_value</span> <span class="kw">%in%</span> <span class="no">states</span>), <span class="kw">plot_type</span> <span class="kw">=</span> <span class="st">"line"</span>)</pre></body></html></div>
<p><img src="plotting-signals_files/figure-html/unnamed-chunk-14-1.png" width="768"></p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">df_inum_st</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">geo_value</span> <span class="kw">%in%</span> <span class="no">states</span>), <span class="kw">plot_type</span> <span class="kw">=</span> <span class="st">"line"</span>)</pre></body></html></div>
<p><img src="plotting-signals_files/figure-html/unnamed-chunk-14-2.png" width="768"></p>
<p>Notice how in Texas, the combined indicator rose several weeks in advance of confirmed cases, suggesting the signal could be predictive. Delphi is investigating these signals for their usefulness in forecasting, as well as hotspot detection and will publish results when they are available.</p>
</div>
<div id="manual-plotting" class="section level2">
<h2 class="hasAnchor">
<a href="#manual-plotting" class="anchor"></a>Manual plotting</h2>
<p>Using <code>ggplot2</code> or your favorite plotting package, we can easily plot time series manually, without using the <code><a href="../reference/plot.covidcast_signal.html">plot.covidcast_signal()</a></code> method. You can use this to customize the appearance of your plots however you choose.</p>
<p>For example:</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)

<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span>({
  <span class="no">df_comb_md</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/covidcast_signal.html">covidcast_signal</a></span>(<span class="kw">data_source</span> <span class="kw">=</span> <span class="st">"indicator-combination"</span>,
                                 <span class="kw">signal</span> <span class="kw">=</span> <span class="st">"nmf_day_doc_fbc_fbs_ght"</span>,
                                 <span class="kw">start_day</span> <span class="kw">=</span> <span class="st">"2020-06-01"</span>, <span class="kw">end_day</span> <span class="kw">=</span> <span class="st">"2020-07-15"</span>,
                                 <span class="kw">geo_values</span> <span class="kw">=</span> <span class="fu"><a href="../reference/name_to_fips.html">name_to_fips</a></span>(<span class="st">"Miami-Dade"</span>))
  <span class="no">df_inum_md</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/covidcast_signal.html">covidcast_signal</a></span>(<span class="kw">data_source</span> <span class="kw">=</span> <span class="st">"jhu-csse"</span>,
                                 <span class="kw">signal</span> <span class="kw">=</span> <span class="st">"confirmed_7dav_incidence_num"</span>,
                                 <span class="kw">start_day</span> <span class="kw">=</span> <span class="st">"2020-06-01"</span>, <span class="kw">end_day</span> <span class="kw">=</span> <span class="st">"2020-07-15"</span>,
                                 <span class="kw">geo_values</span> <span class="kw">=</span> <span class="fu"><a href="../reference/name_to_fips.html">name_to_fips</a></span>(<span class="st">"Miami-Dade"</span>))
})

<span class="co"># Compute the ranges of the two signals</span>
<span class="no">range1</span> <span class="kw">&lt;-</span> <span class="no">df_inum_md</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="st">"value"</span>) <span class="kw">%&gt;%</span> <span class="no">range</span>
<span class="no">range2</span> <span class="kw">&lt;-</span> <span class="no">df_comb_md</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="st">"value"</span>) <span class="kw">%&gt;%</span> <span class="no">range</span>

<span class="co"># Function to transform from one range to another</span>
<span class="no">trans</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">from_range</span>, <span class="no">to_range</span>) {
  (<span class="no">x</span> - <span class="no">from_range</span>[<span class="fl">1</span>]) / (<span class="no">from_range</span>[<span class="fl">2</span>] - <span class="no">from_range</span>[<span class="fl">1</span>]) *
    (<span class="no">to_range</span>[<span class="fl">2</span>] - <span class="no">to_range</span>[<span class="fl">1</span>]) + <span class="no">to_range</span>[<span class="fl">1</span>]
}

<span class="co"># Convenience functions for our two signal ranges</span>
<span class="no">trans12</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu">trans</span>(<span class="no">x</span>, <span class="no">range1</span>, <span class="no">range2</span>)
<span class="no">trans21</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu">trans</span>(<span class="no">x</span>, <span class="no">range2</span>, <span class="no">range1</span>)

<span class="co"># Transform the combined signal to the incidence range, then stack</span>
<span class="co"># these rowwise into one data frame</span>
<span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">df_comb_md</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span>(<span class="st">"value"</span>, <span class="no">trans21</span>),
                   <span class="no">df_inum_md</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"time_value"</span>, <span class="st">"value"</span>))
<span class="no">df</span>$<span class="no">signal</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"Combined indicator"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">df_comb_md</span>)),
               <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"New COVID-19 cases"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">df_inum_md</span>)))

<span class="co"># Finally, plot both signals</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">time_value</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">value</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Date"</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Miami-Dade County"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="no">signal</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span>(
    <span class="kw">name</span> <span class="kw">=</span> <span class="st">"New COVID-19 cases (7-day trailing avg)"</span>,
    <span class="kw">sec.axis</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/sec_axis.html">sec_axis</a></span>(<span class="no">trans12</span>, <span class="kw">name</span> <span class="kw">=</span> <span class="st">"Combination of COVID-19 indicators"</span>)
  ) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"bottom"</span>,
        <span class="kw">legend.title</span> <span class="kw">=</span> <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>())</pre></body></html></div>
<p><img src="plotting-signals_files/figure-html/unnamed-chunk-15-1.png" width="768"></p>
<p>Again, we see that the combined indicator starts rising several days before the new COVID-19 cases do, an exciting phenomenon that Delphi is studying now.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jacob Bien, Logan Brooks, David Farrow, Pedrito Maynard-Zhang, Alex Reinhart, Ryan Tibshirani.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
